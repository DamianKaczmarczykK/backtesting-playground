import { expect, test } from "vitest";
import { detectCurrencySymbols, parseYahooCsv } from "../src/services/DataImporter";

const yahooFinanceCsv = `
Date,Open,High,Low,Close,Adj Close,Volume
2021-01-01,28994.009766,29600.626953,28803.585938,29374.152344,29374.152344,40730301359
2021-01-02,29376.455078,33155.117188,29091.181641,32127.267578,32127.267578,67865420765
2021-01-03,32129.408203,34608.558594,32052.316406,32782.023438,32782.023438,78665235202
2021-01-04,32810.949219,33440.218750,28722.755859,31971.914063,31971.914063,81163475344
2021-01-05,31977.041016,34437.589844,30221.187500,33992.429688,33992.429688,67547324782
2021-01-06,34013.613281,36879.699219,33514.035156,36824.363281,36824.363281,75289433811
2021-01-07,36833.875000,40180.367188,36491.191406,39371.042969,39371.042969,84762141031
2021-01-08,39381.765625,41946.738281,36838.636719,40797.609375,40797.609375,88107519480
2021-01-09,40788.640625,41436.351563,38980.875000,40254.546875,40254.546875,61984162837
2021-01-10,40254.218750,41420.191406,35984.628906,38356.441406,38356.441406,79980747690
2021-01-11,38346.531250,38346.531250,30549.599609,35566.656250,35566.656250,123320567399
2021-01-12,35516.359375,36568.527344,32697.976563,33922.960938,33922.960938,74773277909
2021-01-13,33915.121094,37599.960938,32584.667969,37316.359375,37316.359375,69364315979
2021-01-14,37325.109375,39966.406250,36868.562500,39187.328125,39187.328125,63615990033
2021-01-15,39156.707031,39577.710938,34659.589844,36825.367188,36825.367188,67760757881
2021-01-16,36821.648438,37864.367188,35633.554688,36178.140625,36178.140625,57706187875
2021-01-17,36163.648438,36722.351563,34069.320313,35791.277344,35791.277344,52359854336
2021-01-18,35792.238281,37299.285156,34883.843750,36630.074219,36630.074219,49511702429
2021-01-19,36642.234375,37755.890625,36069.804688,36069.804688,36069.804688,57244195486
`;

test('successfully parse csv with YahooFinance format', () => {
	const firstCandle = { time: '2021-01-01', open: 28994.009766, high: 29600.626953, low: 28803.585938, close: 29374.152344, volume: 40730301359 };

	const [actual, _err] = parseYahooCsv(yahooFinanceCsv)

	expect(actual).toHaveLength(19);
	expect(actual[0])
		.toStrictEqual(firstCandle)

})

test('detect base and quote symbols', () => {
	const [base, quote] = detectCurrencySymbols('BTC-USD.csv');

	expect(base).toBe("BTC");
	expect(quote).toBe("USD");

})
